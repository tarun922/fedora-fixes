<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Fedora Fixes</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root {
  --bg-start: #e8e9ed;
  --bg-end: #f5f6fa;
  --glass: rgba(255,255,255,0.4);
  --glass-strong: rgba(255,255,255,0.7);
  --border: rgba(255,255,255,0.6);
  --text: #2a2a2a;
  --muted: #666;
  --accent: #888;
  --shadow: rgba(0,0,0,0.08);
  --shadow-strong: rgba(0,0,0,0.15);
}

* { box-sizing: border-box; margin: 0; padding: 0; }

body {
  font-family: "Segoe UI", system-ui, -apple-system, sans-serif;
  background: linear-gradient(135deg, var(--bg-start), var(--bg-end));
  color: var(--text);
  min-height: 100vh;
  position: relative;
}

body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: 
    radial-gradient(circle at 20% 30%, rgba(200,200,200,0.1) 0%, transparent 50%),
    radial-gradient(circle at 80% 70%, rgba(150,150,150,0.1) 0%, transparent 50%);
  pointer-events: none;
  z-index: 0;
}

.wrapper {
  max-width: 1200px;
  margin: auto;
  padding: 2rem;
  position: relative;
  z-index: 1;
}

.glass {
  background: var(--glass);
  backdrop-filter: blur(24px) saturate(180%);
  -webkit-backdrop-filter: blur(24px) saturate(180%);
  border: 1px solid var(--border);
  border-radius: 20px;
  box-shadow: 
    0 8px 32px var(--shadow),
    inset 0 1px 0 rgba(255,255,255,0.8);
}

.glass-strong {
  background: var(--glass-strong);
  backdrop-filter: blur(30px) saturate(200%);
  -webkit-backdrop-filter: blur(30px) saturate(200%);
}

header {
  padding: 2.5rem;
  animation: fadeUp 0.8s ease;
  position: relative;
}

header h1 {
  font-size: 3.2rem;
  background: linear-gradient(135deg, #3a3a3a, #6a6a6a);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  font-weight: 700;
  letter-spacing: -0.02em;
}

header p {
  max-width: 760px;
  font-size: 1.1rem;
  color: var(--muted);
  line-height: 1.7;
  margin-top: 1rem;
}

.user-section {
  position: absolute;
  top: 2rem;
  right: 2rem;
  display: flex;
  gap: 0.5rem;
  align-items: center;
}

.user-email {
  font-size: 0.85rem;
  color: var(--muted);
  margin-right: 0.5rem;
  font-weight: 500;
}

.actions {
  margin-top: 1.5rem;
  display: flex;
  gap: 0.6rem;
  flex-wrap: wrap;
}

.glass-btn {
  border: 1px solid rgba(255, 255, 255, 0.5);
  background: linear-gradient(135deg, rgba(255, 255, 255, 0.7), rgba(240, 240, 240, 0.5));
  backdrop-filter: blur(16px);
  -webkit-backdrop-filter: blur(16px);
  color: #2a2a2a;
  font-family: inherit;
  font-size: 0.85rem;
  font-weight: 600;
  padding: 0.65rem 1.3rem;
  border-radius: 12px;
  cursor: pointer;
  box-shadow: 
    0 4px 16px var(--shadow),
    inset 0 1px 0 rgba(255, 255, 255, 0.8);
  transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
  text-decoration: none;
  display: inline-block;
}

.glass-btn:hover {
  background: linear-gradient(135deg, rgba(255, 255, 255, 0.85), rgba(245, 245, 245, 0.65));
  transform: translateY(-2px);
  box-shadow: 
    0 8px 24px var(--shadow-strong),
    inset 0 1px 0 rgba(255, 255, 255, 0.9);
}

.glass-btn:active {
  transform: translateY(0);
  box-shadow: 
    0 2px 8px var(--shadow),
    inset 0 2px 4px rgba(0, 0, 0, 0.1);
}

.glass-btn.secondary {
  font-size: 0.8rem;
  padding: 0.5rem 1rem;
}

.btn-ai {
  background: linear-gradient(135deg, #1a1a1a, #3a3a3a, #1a1a1a);
  background-size: 200% 200%;
  border: 1px solid rgba(255,255,255,0.1);
  color: white;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  box-shadow: 
    0 8px 32px rgba(0,0,0,0.4),
    0 0 20px rgba(100,100,100,0.3),
    inset 0 1px 0 rgba(255,255,255,0.1);
  animation: shimmer 3s ease infinite;
  position: relative;
  overflow: hidden;
}

.btn-ai::before {
  content: '';
  position: absolute;
  top: -50%;
  left: -50%;
  width: 200%;
  height: 200%;
  background: linear-gradient(
    45deg,
    transparent,
    rgba(255,255,255,0.1),
    transparent
  );
  transform: rotate(45deg);
  animation: shine 3s ease infinite;
}

.btn-ai:hover {
  background: linear-gradient(135deg, #2a2a2a, #4a4a4a, #2a2a2a);
  background-size: 200% 200%;
  transform: translateY(-3px) scale(1.02);
  box-shadow: 
    0 12px 40px rgba(0,0,0,0.5),
    0 0 30px rgba(150,150,150,0.4),
    inset 0 1px 0 rgba(255,255,255,0.2);
}

@keyframes shimmer {
  0%, 100% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
}

@keyframes shine {
  0% { transform: rotate(45deg) translate(-100%, -100%); }
  100% { transform: rotate(45deg) translate(100%, 100%); }
}

.tabs {
  margin-top: 2.5rem;
  display: flex;
  gap: 0.5rem;
  flex-wrap: wrap;
}

.tabs button {
  border: 1px solid rgba(255,255,255,0.5);
  background: linear-gradient(135deg, rgba(255,255,255,0.6), rgba(240,240,240,0.4));
  backdrop-filter: blur(12px);
  padding: 0.55rem 1.1rem;
  border-radius: 12px;
  font-size: 0.85rem;
  font-weight: 600;
  cursor: pointer;
  box-shadow: 0 4px 12px var(--shadow);
  transition: all 0.2s ease;
  color: var(--text);
}

.tabs button:hover {
  background: linear-gradient(135deg, rgba(255,255,255,0.75), rgba(245,245,245,0.55));
  transform: translateY(-1px);
}

.tabs button.active {
  background: linear-gradient(135deg, #d0d0d0, #e0e0e0);
  box-shadow: 0 2px 8px var(--shadow), inset 0 2px 4px rgba(0,0,0,0.1);
}

.grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 1.3rem;
  margin-top: 1.8rem;
}

.card {
  padding: 1.6rem;
  animation: fadeUp 0.7s ease;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.card:hover {
  transform: translateY(-4px);
  box-shadow: 
    0 12px 40px var(--shadow-strong),
    inset 0 1px 0 rgba(255,255,255,0.9);
}

.card h3 {
  font-size: 1.1rem;
  display: flex;
  align-items: center;
  gap: 0.6rem;
  font-weight: 700;
  color: var(--text);
}

.card p {
  font-size: 0.9rem;
  color: var(--muted);
  line-height: 1.6;
  margin: 0.8rem 0 1rem;
}

.badge {
  font-size: 0.7rem;
  background: linear-gradient(135deg, #e0e0e0, #f0f0f0);
  padding: 0.25rem 0.6rem;
  border-radius: 8px;
  color: #444;
  font-weight: 600;
  box-shadow: 0 2px 6px rgba(0,0,0,0.08);
}

.card-actions {
  display: flex;
  gap: 0.4rem;
  flex-wrap: wrap;
}

.card-actions button,
.card-actions a {
  font-size: 0.75rem;
  font-weight: 600;
  padding: 0.4rem 0.8rem;
  border-radius: 8px;
  border: 1px solid rgba(255,255,255,0.5);
  background: linear-gradient(135deg, rgba(255,255,255,0.7), rgba(240,240,240,0.5));
  backdrop-filter: blur(8px);
  cursor: pointer;
  box-shadow: 0 2px 8px var(--shadow);
  transition: all 0.2s ease;
  text-decoration: none;
  color: var(--text);
}

.card-actions button:hover,
.card-actions a:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px var(--shadow-strong);
  background: linear-gradient(135deg, rgba(255,255,255,0.85), rgba(245,245,245,0.65));
}

footer {
  margin-top: 3rem;
  padding: 1.5rem;
  font-size: 0.85rem;
  color: var(--muted);
  text-align: center;
  font-weight: 500;
}

/* MODAL */
.modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0,0,0,0.4);
  backdrop-filter: blur(8px);
  z-index: 1000;
  align-items: center;
  justify-content: center;
  animation: fadeIn 0.3s ease;
}

.modal.active {
  display: flex;
}

.modal-content {
  background: linear-gradient(135deg, rgba(255,255,255,0.95), rgba(245,245,245,0.9));
  backdrop-filter: blur(40px);
  border: 1px solid rgba(255,255,255,0.8);
  border-radius: 24px;
  padding: 2.5rem;
  max-width: 600px;
  width: 90%;
  max-height: 85vh;
  overflow-y: auto;
  box-shadow: 
    0 24px 80px rgba(0,0,0,0.3),
    inset 0 1px 0 rgba(255,255,255,1);
  animation: slideUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

.modal-content h2 {
  margin: 0 0 1.5rem 0;
  font-size: 1.8rem;
  font-weight: 700;
  background: linear-gradient(135deg, #2a2a2a, #5a5a5a);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.modal-content .close {
  float: right;
  font-size: 1.8rem;
  cursor: pointer;
  color: var(--muted);
  line-height: 1;
  transition: all 0.2s ease;
}

.modal-content .close:hover {
  color: var(--text);
  transform: scale(1.1);
}

.form-group {
  margin-bottom: 1.2rem;
}

.form-group label {
  display: block;
  font-size: 0.9rem;
  font-weight: 700;
  margin-bottom: 0.5rem;
  color: var(--text);
}

.form-group input,
.form-group textarea,
.form-group select {
  width: 100%;
  padding: 0.8rem;
  border: 1px solid rgba(200,200,200,0.5);
  background: rgba(255,255,255,0.7);
  backdrop-filter: blur(8px);
  border-radius: 12px;
  font-family: inherit;
  font-size: 0.95rem;
  transition: all 0.2s ease;
  box-shadow: 0 2px 8px rgba(0,0,0,0.05);
}

.form-group input:focus,
.form-group textarea:focus,
.form-group select:focus {
  outline: none;
  border-color: #999;
  background: rgba(255,255,255,0.9);
  box-shadow: 0 4px 16px rgba(0,0,0,0.1);
}

.form-group textarea {
  resize: vertical;
  min-height: 120px;
}

.form-actions {
  display: flex;
  gap: 0.6rem;
  margin-top: 1.8rem;
}

.btn-primary {
  background: linear-gradient(135deg, #4a4a4a, #6a6a6a);
  color: white;
  border: none;
  padding: 0.8rem 1.8rem;
  border-radius: 12px;
  font-weight: 700;
  font-size: 0.95rem;
  cursor: pointer;
  transition: all 0.25s ease;
  flex: 1;
  box-shadow: 0 6px 20px rgba(0,0,0,0.2);
}

.btn-primary:hover {
  background: linear-gradient(135deg, #5a5a5a, #7a7a7a);
  transform: translateY(-2px);
  box-shadow: 0 8px 28px rgba(0,0,0,0.3);
}

.btn-secondary {
  background: linear-gradient(135deg, rgba(230,230,230,0.8), rgba(240,240,240,0.6));
  color: var(--text);
  border: 1px solid rgba(200,200,200,0.5);
  padding: 0.8rem 1.8rem;
  border-radius: 12px;
  font-weight: 700;
  font-size: 0.95rem;
  cursor: pointer;
  transition: all 0.25s ease;
  backdrop-filter: blur(8px);
}

.btn-secondary:hover {
  background: linear-gradient(135deg, rgba(220,220,220,0.9), rgba(235,235,235,0.7));
  transform: translateY(-2px);
}

.success-message {
  background: linear-gradient(135deg, #d4f4dd, #e8f8ed);
  color: #1a5928;
  padding: 1rem;
  border-radius: 12px;
  margin-bottom: 1rem;
  font-size: 0.9rem;
  font-weight: 600;
  border: 1px solid rgba(26,89,40,0.2);
  box-shadow: 0 4px 12px rgba(0,0,0,0.08);
}

.error-message {
  background: linear-gradient(135deg, #fdd, #fee);
  color: #8b1a1a;
  padding: 1rem;
  border-radius: 12px;
  margin-bottom: 1rem;
  font-size: 0.9rem;
  font-weight: 600;
  border: 1px solid rgba(139,26,26,0.2);
  box-shadow: 0 4px 12px rgba(0,0,0,0.08);
}

/* AI CHAT MODAL */
#aiChatModal .modal-content {
  max-width: 800px;
  max-height: 90vh;
  display: flex;
  flex-direction: column;
}

.chat-container {
  flex: 1;
  overflow-y: auto;
  padding: 1rem;
  margin: 1rem 0;
  background: rgba(240,240,240,0.5);
  border-radius: 16px;
  min-height: 400px;
  max-height: 500px;
}

.chat-message {
  margin-bottom: 1rem;
  padding: 1rem;
  border-radius: 12px;
  animation: slideIn 0.3s ease;
  backdrop-filter: blur(8px);
  box-shadow: 0 2px 8px rgba(0,0,0,0.08);
}

.chat-message.user {
  background: linear-gradient(135deg, rgba(100,100,100,0.2), rgba(120,120,120,0.15));
  margin-left: 2rem;
  border: 1px solid rgba(100,100,100,0.2);
}

.chat-message.ai {
  background: linear-gradient(135deg, rgba(255,255,255,0.8), rgba(245,245,245,0.6));
  margin-right: 2rem;
  border: 1px solid rgba(200,200,200,0.3);
}

.chat-message strong {
  display: block;
  margin-bottom: 0.5rem;
  font-size: 0.85rem;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  color: var(--muted);
}

.chat-input-container {
  display: flex;
  gap: 0.6rem;
}

.chat-input-container input {
  flex: 1;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

@keyframes slideUp {
  from { opacity: 0; transform: translateY(30px); }
  to { opacity: 1; transform: translateY(0); }
}

@keyframes slideIn {
  from { opacity: 0; transform: translateX(-10px); }
  to { opacity: 1; transform: translateX(0); }
}

@keyframes fadeUp {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}

@media (max-width: 700px) {
  header h1 { font-size: 2.5rem; }
  .user-section {
    position: static;
    margin-top: 1rem;
    justify-content: flex-start;
  }
  .modal-content {
    padding: 1.5rem;
  }
  .chat-container {
    min-height: 300px;
    max-height: 400px;
  }
}
</style>
</head>

<body>

<div class="wrapper">
  <header class="glass glass-strong">
    <div class="user-section" id="userSection">
      <button class="glass-btn secondary" onclick="showModal('loginModal')">Login</button>
      <button class="glass-btn secondary" onclick="showModal('signupModal')">Sign Up</button>
    </div>
    
    <h1>Fedora Fixes</h1>
    <p>
      Fedora Fixes is a curated, minimal, and transparent collection of repair
      and optimization scripts designed to solve real Fedora Linux issues.
      Each script focuses on a single responsibility, follows best practices,
      and can be downloaded instantly â€” no redirects, no clutter.
    </p>

    <div class="actions">
      <a href="https://github.com/tarun922/fedora-fixes/archive/refs/heads/main.zip" class="glass-btn">
        â¬‡ Download All (ZIP)
      </a>
      <a href="https://github.com/tarun922/fedora-fixes" class="glass-btn">
        â˜… GitHub Repository
      </a>
      <button class="glass-btn btn-ai" onclick="showModal('aiChatModal')">
        âœ¨ Ask AI Assistant
      </button>
      <button class="glass-btn" onclick="showModal('feedbackModal')">ðŸ’¬ Feedback</button>
      <button class="glass-btn" onclick="showModal('problemModal')">ðŸ”§ Report Problem</button>
      <button class="glass-btn" onclick="showModal('contributeModal')">âž• Contribute Fix</button>
    </div>
  </header>

  <div class="tabs">
    <button class="active" onclick="filter('all')">All</button>
    <button onclick="filter('audio')">Audio</button>
    <button onclick="filter('network')">Network</button>
    <button onclick="filter('system')">System</button>
    <button onclick="filter('drivers')">Drivers</button>
  </div>

  <div class="grid" id="grid"></div>

  <footer class="glass">
    Designed with clarity and restraint â€¢ tarun922 / fedora-fixes
  </footer>
</div>

<!-- Login Modal -->
<div class="modal" id="loginModal">
  <div class="modal-content">
    <span class="close" onclick="closeModal('loginModal')">&times;</span>
    <h2>Login</h2>
    <div id="loginMessage"></div>
    <form onsubmit="handleLogin(event)">
      <div class="form-group">
        <label>Email</label>
        <input type="email" id="loginEmail" required>
      </div>
      <div class="form-group">
        <label>Password</label>
        <input type="password" id="loginPassword" required>
      </div>
      <div class="form-actions">
        <button type="submit" class="btn-primary">Login</button>
        <button type="button" class="btn-secondary" onclick="closeModal('loginModal')">Cancel</button>
      </div>
    </form>
  </div>
</div>

<!-- Signup Modal -->
<div class="modal" id="signupModal">
  <div class="modal-content">
    <span class="close" onclick="closeModal('signupModal')">&times;</span>
    <h2>Sign Up</h2>
    <div id="signupMessage"></div>
    <form onsubmit="handleSignup(event)">
      <div class="form-group">
        <label>Email</label>
        <input type="email" id="signupEmail" required>
      </div>
      <div class="form-group">
        <label>Password</label>
        <input type="password" id="signupPassword" required minlength="6">
      </div>
      <div class="form-group">
        <label>Confirm Password</label>
        <input type="password" id="signupPasswordConfirm" required minlength="6">
      </div>
      <div class="form-actions">
        <button type="submit" class="btn-primary">Sign Up</button>
        <button type="button" class="btn-secondary" onclick="closeModal('signupModal')">Cancel</button>
      </div>
    </form>
  </div>
</div>

<!-- AI Chat Modal -->
<div class="modal" id="aiChatModal">
  <div class="modal-content">
    <span class="close" onclick="closeModal('aiChatModal')">&times;</span>
    <h2>âœ¨ AI Assistant - Fedora Help</h2>
    <div class="chat-container" id="chatContainer">
      <div class="chat-message ai">
        <strong>AI Assistant</strong>
        <div>Hello! I'm here to help you with Fedora Linux issues. Ask me anything about fixing problems, optimizing your system, or which script to use!</div>
      </div>
    </div>
    <div class="chat-input-container">
      <input type="text" id="chatInput" placeholder="Ask about Fedora issues..." onkeypress="if(event.key==='Enter') sendMessage()">
      <button class="btn-primary" onclick="sendMessage()">Send</button>
    </div>
  </div>
</div>

<!-- Feedback Modal -->
<div class="modal" id="feedbackModal">
  <div class="modal-content">
    <span class="close" onclick="closeModal('feedbackModal')">&times;</span>
    <h2>Share Feedback</h2>
    <div id="feedbackMessage"></div>
    <form onsubmit="handleFeedback(event)">
      <div class="form-group">
        <label>Type</label>
        <select id="feedbackType" required>
          <option value="">Select type...</option>
          <option value="bug">Bug Report</option>
          <option value="feature">Feature Request</option>
          <option value="improvement">Improvement</option>
          <option value="general">General Feedback</option>
        </select>
      </div>
      <div class="form-group">
        <label>Subject</label>
        <input type="text" id="feedbackSubject" required>
      </div>
      <div class="form-group">
        <label>Details</label>
        <textarea id="feedbackDetails" required></textarea>
      </div>
      <div class="form-actions">
        <button type="submit" class="btn-primary">Submit</button>
        <button type="button" class="btn-secondary" onclick="closeModal('feedbackModal')">Cancel</button>
      </div>
    </form>
  </div>
</div>

<!-- Problem Report Modal -->
<div class="modal" id="problemModal">
  <div class="modal-content">
    <span class="close" onclick="closeModal('problemModal')">&times;</span>
    <h2>Report a Problem</h2>
    <div id="problemMessage"></div>
    <form onsubmit="handleProblem(event)">
      <div class="form-group">
        <label>Problem Category</label>
        <select id="problemCategory" required>
          <option value="">Select category...</option>
          <option value="audio">Audio</option>
          <option value="network">Network</option>
          <option value="system">System</option>
          <option value="drivers">Drivers</option>
          <option value="display">Display</option>
          <option value="other">Other</option>
        </select>
      </div>
      <div class="form-group">
        <label>Problem Title</label>
        <input type="text" id="problemTitle" required>
      </div>
      <div class="form-group">
        <label>Fedora Version</label>
        <input type="text" id="problemVersion" placeholder="e.g., Fedora 39">
      </div>
      <div class="form-group">
        <label>Description</label>
        <textarea id="problemDescription" required placeholder="Describe your problem in detail..."></textarea>
      </div>
      <div class="form-actions">
        <button type="submit" class="btn-primary">Submit</button>
        <button type="button" class="btn-secondary" onclick="closeModal('problemModal')">Cancel</button>
      </div>
    </form>
  </div>
</div>

<!-- Contribute Fix Modal -->
<div class="modal" id="contributeModal">
  <div class="modal-content">
    <span class="close" onclick="closeModal('contributeModal')">&times;</span>
    <h2>Contribute a Fix</h2>
    <div id="contributeMessage"></div>
    <form onsubmit="handleContribute(event)">
      <div class="form-group">
        <label>Fix Name</label>
        <input type="text" id="contributeName" required placeholder="e.g., GPU-Fix.sh">
      </div>
      <div class="form-group">
        <label>Category</label>
        <select id="contributeCategory" required>
          <option value="">Select category...</option>
          <option value="audio">Audio</option>
          <option value="network">Network</option>
          <option value="system">System</option>
          <option value="drivers">Drivers</option>
        </select>
      </div>
      <div class="form-group">
        <label>Description</label>
        <textarea id="contributeDescription" required placeholder="What does this fix do?"></textarea>
      </div>
      <div class="form-group">
        <label>Script Content or GitHub Link</label>
        <textarea id="contributeScript" required placeholder="Paste your script or provide a link to it..."></textarea>
      </div>
      <div class="form-group">
        <label>Tested On (Fedora Version)</label>
        <input type="text" id="contributeTested" placeholder="e.g., Fedora 39, 40">
      </div>
      <div class="form-actions">
        <button type="submit" class="btn-primary">Submit</button>
        <button type="button" class="btn-secondary" onclick="closeModal('contributeModal')">Cancel</button>
      </div>
    </form>
  </div>
</div>

<script type="module">
import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
import { getFirestore, collection, addDoc, serverTimestamp, query, orderBy, limit, getDocs } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

const firebaseConfig = {
  apiKey: "AIzaSyAzgPBEg9-kxhnufbsO44di__8VfIlWchA",
  authDomain: "fedora-fixes-org.firebaseapp.com",
  projectId: "fedora-fixes-org",
  storageBucket: "fedora-fixes-org.firebasestorage.app",
  messagingSenderId: "941066229052",
  appId: "1:941066229052:web:c8aef6ff143429e858ba39",
  measurementId: "G-JPLZVJ1ZQ3"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

window.currentUser = null;
window.chatHistory = [];

onAuthStateChanged(auth, (user) => {
  window.currentUser = user;
  updateUserSection(user);
  if (user) {
    loadChatHistory(user.uid);
  }
});

function updateUserSection(user) {
  const section = document.getElementById('userSection');
  if (user) {
    section.innerHTML = `
      <span class="user-email">${user.email}</span>
      <button class="glass-btn secondary" onclick="handleLogout()">Logout</button>
    `;
  } else {
    section.innerHTML = `
      <button class="glass-btn secondary" onclick="showModal('loginModal')">Login</button>
      <button class="glass-btn secondary" onclick="showModal('signupModal')">Sign Up</button>
    `;
  }
}

async function loadChatHistory(userId) {
  try {
    const q = query(
      collection(db, 'chats'),
      orderBy('timestamp', 'desc'),
      limit(10)
    );
    const snapshot = await getDocs(q);
    window.chatHistory = [];
    snapshot.forEach(doc => {
      const data = doc.data();
      if (data.userId === userId) {
        window.chatHistory.push(data);
      }
    });
  } catch (error) {
    console.error('Error loading chat history:', error);
  }
}

window.handleLogin = async (e) => {
  e.preventDefault();
  const email = document.getElementById('loginEmail').value;
  const password = document.getElementById('loginPassword').value;
  const messageDiv = document.getElementById('loginMessage');
  
  try {
    await signInWithEmailAndPassword(auth, email, password);
    messageDiv.innerHTML = '<div class="success-message">Login successful!</div>';
    setTimeout(() => closeModal('loginModal'), 1500);
  } catch (error) {
    messageDiv.innerHTML = `<div class="error-message">${error.message}</div>`;
  }
};

window.handleSignup = async (e) => {
  e.preventDefault();
  const email = document.getElementById('signupEmail').value;
  const password = document.getElementById('signupPassword').value;
  const confirmPassword = document.getElementById('signupPasswordConfirm').value;
  const messageDiv = document.getElementById('signupMessage');
  
  if (password !== confirmPassword) {
    messageDiv.innerHTML = '<div class="error-message">Passwords do not match!</div>';
    return;
  }
  
  try {
    await createUserWithEmailAndPassword(auth, email, password);
    messageDiv.innerHTML = '<div class="success-message">Account created successfully!</div>';
    setTimeout(() => closeModal('signupModal'), 1500);
  } catch (error) {
    messageDiv.innerHTML = `<div class="error-message">${error.message}</div>`;
  }
};

window.handleLogout = async () => {
  try {
    await signOut(auth);
  } catch (error) {
    console.error('Logout error:', error);
  }
};

window.sendMessage = async () => {
  const input = document.getElementById('chatInput');
  const message = input.value.trim();
  
  if (!message) return;
  
  const container = document.getElementById('chatContainer');
  
  // Add user message
  container.innerHTML += `
    <div class="chat-message user">
      <strong>You</strong>
      <div>${message}</div>
    </div>
  `;
  
  input.value = '';
  container.scrollTop = container.scrollHeight;
  
  // Add loading indicator
  container.innerHTML += `
    <div class="chat-message ai" id="aiLoading">
      <strong>AI Assistant</strong>
      <div>Thinking...</div>
    </div>
  `;
  container.scrollTop = container.scrollHeight;
  
  try {
    // Call OpenRouter API
    const apiKey = process.env.KEY;
    const response = await fetch('https://openrouter.ai/api/v1/chat/completions', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${apikey}`,
        'HTTP-Referer': window.location.href,
        'X-Title': 'Fedora Fixes'
      },
      body: JSON.stringify({
        model: 'mistralai/devstral-2512:free',
        messages: [
          {
            role: 'system',
            content: 'You are a helpful AI assistant specializing in Fedora Linux. Help users solve their Fedora issues, recommend appropriate fix scripts from the Fedora Fixes collection, and provide technical guidance. Be concise and practical.'
          },
          {
            role: 'user',
            content: message
          }
        ]
      })
    });
    
    const data = await response.json();
    const aiMessage = data.choices[0]?.message?.content || 'Sorry, I could not generate a response.';
    
    // Remove loading indicator
    document.getElementById('aiLoading').remove();
    
    // Add AI response
    container.innerHTML += `
      <div class="chat-message ai">
        <strong>AI Assistant</strong>
        <div>${aiMessage}</div>
      </div>
    `;
    
    container.scrollTop = container.scrollHeight;
    
    // Save to Firestore
    if (window.currentUser) {
      await addDoc(collection(db, 'chats'), {
        userId: window.currentUser.uid,
        userEmail: window.currentUser.email,
        userMessage: message,
        aiResponse: aiMessage,
        timestamp: serverTimestamp()
      });
    }
    
  } catch (error) {
    document.getElementById('aiLoading').remove();
    container.innerHTML += `
      <div class="chat-message ai">
        <strong>AI Assistant</strong>
        <div>Sorry, there was an error: ${error.message}. Please make sure to add your OpenRouter API key.</div>
      </div>
    `;
    container.scrollTop = container.scrollHeight;
  }
};

window.handleFeedback = async (e) => {
  e.preventDefault();
  const messageDiv = document.getElementById('feedbackMessage');
  
  try {
    await addDoc(collection(db, 'feedback'), {
      type: document.getElementById('feedbackType').value,
      subject: document.getElementById('feedbackSubject').value,
      details: document.getElementById('feedbackDetails').value,
      userEmail: window.currentUser?.email || 'anonymous',
      timestamp: serverTimestamp()
    });
    
    messageDiv.innerHTML = '<div class="success-message">Thank you for your feedback!</div>';
    e.target.reset();
    setTimeout(() => closeModal('feedbackModal'), 2000);
  } catch (error) {
    messageDiv.innerHTML = `<div class="error-message">Error: ${error.message}</div>`;
  }
};

window.handleProblem = async (e) => {
  e.preventDefault();
  const messageDiv = document.getElementById('problemMessage');
  
  try {
    await addDoc(collection(db, 'problems'), {
      category: document.getElementById('problemCategory').value,
      title: document.getElementById('problemTitle').value,
      version: document.getElementById('problemVersion').value,
      description: document.getElementById('problemDescription').value,
      userEmail: window.currentUser?.email || 'anonymous',
      timestamp: serverTimestamp()
    });
    
    messageDiv.innerHTML = '<div class="success-message">Problem reported successfully!</div>';
    e.target.reset();
    setTimeout(() => closeModal('problemModal'), 2000);
  } catch (error) {
    messageDiv.innerHTML = `<div class="error-message">Error: ${error.message}</div>`;
  }
};

window.handleContribute = async (e) => {
  e.preventDefault();
  const messageDiv = document.getElementById('contributeMessage');
  
  if (!window.currentUser) {
    messageDiv.innerHTML = '<div class="error-message">Please login to contribute fixes.</div>';
    return;
  }
  
  try {
    await addDoc(collection(db, 'contributions'), {
      name: document.getElementById('contributeName').value,
      category: document.getElementById('contributeCategory').value,
      description: document.getElementById('contributeDescription').value,
      script: document.getElementById('contributeScript').value,
      tested: document.getElementById('contributeTested').value,
      userEmail: window.currentUser.email,
      timestamp: serverTimestamp(),
      status: 'pending'
    });
    
    messageDiv.innerHTML = '<div class="success-message">Thank you! Your contribution will be reviewed.</div>';
    e.target.reset();
    setTimeout(() => closeModal('contributeModal'), 2000);
  } catch (error) {
    messageDiv.innerHTML = `<div class="error-message">Error: ${error.message}</div>`;
  }
};
</script>

<script>
const scripts = [
 {n:"main.sh", c:"system", i:"ðŸ§™", v:"v2.0", d:"Interactive control center that safely launches all available fixes from a single guided menu."},
 {n:"Audio-Fix.sh", c:"audio", i:"ðŸ”Š", v:"stable", d:"Repairs PipeWire, restores missing outputs, and resolves common sound device issues."},
 {n:"Battery-Fix.sh", c:"system", i:"ðŸ”‹", v:"stable", d:"Optimizes power settings to improve battery life and reduce unnecessary background drain."},
 {n:"Display-Fix.sh", c:"system", i:"ðŸ–¥ï¸", v:"stable", d:"Fixes resolution scaling, screen tearing, and display detection issues."},
 {n:"Flatpak-Fix.sh", c:"system", i:"ðŸ“¦", v:"stable", d:"Repairs broken Flatpak installations, permissions, and runtime mismatches."},
 {n:"Input-Fix.sh", c:"system", i:"âŒ¨ï¸", v:"stable", d:"Reduces keyboard and mouse latency for smoother and more responsive input."},
 {n:"Nvidia-Fix.sh", c:"drivers", i:"ðŸ§©", v:"tested", d:"Safely installs and repairs NVIDIA proprietary drivers using recommended Fedora methods."},
 {n:"Share-Fix.sh", c:"system", i:"ðŸ“º", v:"stable", d:"Fixes screen sharing issues across Wayland and X11 sessions."},
 {n:"System-Refresh.sh", c:"system", i:"â™»ï¸", v:"stable", d:"Cleans caches and refreshes system state without affecting personal data."},
 {n:"Update-Fix.sh", c:"system", i:"â¬†ï¸", v:"stable", d:"Fixes DNF update failures, repo conflicts, and metadata corruption."},
 {n:"fix-bluetooth.sh", c:"network", i:"ðŸ”µ", v:"stable", d:"Solves Bluetooth auto-disconnect, headset drops, and adapter issues."},
 {n:"fix-wifi.sh", c:"network", i:"ðŸ“¶", v:"stable", d:"Fixes Wi-Fi driver issues, firmware loading problems, and random disconnects."}
];

const grid = document.getElementById("grid");

function render(list) {
  grid.innerHTML = "";
  list.forEach(s => {
    grid.innerHTML += `
      <div class="card glass">
        <h3>${s.i} ${s.n} <span class="badge">${s.v}</span></h3>
        <p>${s.d}</p>
        <div class="card-actions">
          <a href="${s.n}" download class="glass-btn">Download</a>
          <button onclick="copy('chmod +x ${s.n}')">chmod</button>
          <button onclick="copy('./${s.n}')">run</button>
        </div>
      </div>`;
  });
}

function filter(cat) {
  document.querySelectorAll(".tabs button").forEach(b => b.classList.remove("active"));
  event.target.classList.add("active");
  render(cat === "all" ? scripts : scripts.filter(s => s.c === cat));
}

function copy(text) {
  navigator.clipboard.writeText(text);
}

function showModal(id) {
  document.getElementById(id).classList.add('active');
}

function closeModal(id) {
  document.getElementById(id).classList.remove('active');
  const messageDiv = document.getElementById(id.replace('Modal', 'Message'));
  if (messageDiv) messageDiv.innerHTML = '';
}

window.showModal = showModal;
window.closeModal = closeModal;
window.filter = filter;
window.copy = copy;

render(scripts);

// Close modal on outside click
document.querySelectorAll('.modal').forEach(modal => {
  modal.addEventListener('click', (e) => {
    if (e.target === modal) {
      closeModal(modal.id);
    }
  });
});
</script>

</body>
</html>
